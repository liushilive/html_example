function init(){if(document.getElementById){var e=document.hanoi.diskno;e.options.selectedIndex=0,drawTowers(),drawDisks(parseInt(e.options[e.options.selectedIndex].text))}}function initVars(){for(var e=0;e<disksOnTower1.length;e++)disksOnTower1[e]=null,disksOnTower2[e]=null,disksOnTower3[e]=null;drag=!1,indexTo=1,indexFr=1,movectr=0,zindex=0,idx=0,pos=0,t=null,gameOver=!1,stop=!1,demo=!1,document.hanoi.btnUndo.disabled=!0}function drawTowers(){var e=document.getElementById("title"),t=document.getElementById("tower1"),o=document.getElementById("tower2"),n=document.getElementById("tower3"),s=document.getElementById("settings"),i=parseInt(e.style.width),r=parseInt(e.style.height),l=parseInt(t.style.width),d=parseInt(t.style.height),p=parseInt(s.style.width);midhoriztower=parseInt(document.getElementById("horiztower1").style.width)/2,diskheight=parseInt(document.getElementById("disk1").style.height),e.style.left=offsetleft+1.5*l+offsettower-i/2+"px",e.style.top=offsettop+"px",t.style.left=offsetleft+"px",t.style.top=offsettop+r+offsethoriz+"px",o.style.left=offsetleft+l+offsettower+"px",o.style.top=offsettop+r+offsethoriz+"px",n.style.left=offsetleft+2*(l+offsettower)+"px",n.style.top=offsettop+r+offsethoriz+"px",s.style.left=offsetleft+1.5*l+offsettower-p/2+"px",s.style.top=parseInt(t.style.top)+d+offsethoriz+"px"}function drawDisks(e){var t,o=document.getElementById("tower1"),n=parseInt(o.style.top)+parseInt(document.getElementById("horiztower1").style.top),s=parseInt(o.style.left),i=document.hanoi;basetop=n;for(var r=disksOnTower1.length;r>=1;r--)t=document.getElementById("disk"+r),t.style.zIndex=++zindex,r<=e?(t.style.left=s+midhoriztower-parseInt(t.style.width)/2+"px",t.style.top=n-diskheight-1+"px",n=parseInt(t.style.top),disksOnTowers[0][r-1]=t):(t.style.left="-250px",t.style.top="-250px",disksOnTowers[0][r-1]=null);i.minmove.value=i.diskno.options[i.diskno.options.selectedIndex].value,i.yourmove.value=0}function newGame(e){movectr>0&&!gameOver&&!stop?confirm("当前的游戏将被中止，你想继续吗？")?(initVars(),drawDisks(parseInt(e.options[e.options.selectedIndex].text))):document.hanoi.diskno.options.selectedIndex=prevIndex:(initVars(),drawDisks(parseInt(e.options[e.options.selectedIndex].text)))}function initializeDrag(e,t){t||(t=event),stop?alert("不能在点击'stop'按钮之后在继续执行移动盘子的操作！！"):(indexFr=indexTo,e.id!=disksOnTowers[indexFr-1][0].id||gameOver||demo||(objDisk=e,x=t.clientX,y=t.clientY,tempx=parseInt(e.style.left),tempy=parseInt(e.style.top),document.onmousemove=dragDisk))}function dragDisk(e){e||(e=event),zindex++,drag=!0;var t=tempx+e.clientX-x,o=tempy+e.clientY-y,n=document.getElementById("tower1"),s=document.getElementById("tower2"),i=document.getElementById("tower3"),r=parseInt(n.style.left),l=parseInt(s.style.left),d=parseInt(i.style.left),p=parseInt(i.style.width);return objDisk.style.zIndex=zindex,objDisk.style.left=t+"px",objDisk.style.top=o+"px",e.clientX>=document.body.clientWidth-10||e.clientY>=document.body.clientHeight-5||5==e.clientX||5==e.clientY?(indexTo=indexFr,dropDisk(objDisk)):indexTo=d<=t&&d+p>=t&&parseInt(i.style.top)+parseInt(i.style.height)>o?3:l<=t&&l+p>=t?2:r<=t&&r+parseInt(n.style.width)>=t?1:indexFr,!1}function dropDisk(e){var t=document.hanoi;if(document.onmousemove=new Function("return false"),drag){var o=!1,n=disksOnTowers[indexTo-1][0];indexFr==indexTo?(getNewTop(indexFr,null),pushDisk(e,indexFr),getNewTop(indexFr,e)):null==n?(pushDisk(e,indexTo),getNewTop(indexFr,null),getNewTop(indexTo,e),movectr++,currTower=indexTo,prevTower=indexFr,t.btnUndo.disabled=!1):parseInt(e.style.width)<parseInt(n.style.width)?(pushDisk(e,indexTo),getNewTop(indexFr,null),getNewTop(indexTo,e),movectr++,currTower=indexTo,prevTower=indexFr,3==indexTo&&(o=checkStatus()),t.btnUndo.disabled=!1):(getNewTop(indexFr,null),pushDisk(e,indexFr),getNewTop(indexFr,e)),drag=!1,t.yourmove.value=movectr,o&&(t.btnUndo.disabled=!0,minmove=parseInt(t.minmove.value),movectr==minmove?msg="\n恭喜你!你成功 "+minmove+" 次移动完成。":movectr>minmove?msg="\n你可以做得更好。":msg="",setTimeout(function(){alert("干的漂亮 !!!"+msg)},500),gameOver=!0)}}function checkStatus(){for(var e=!1,t=0,o=0;o<disksOnTower3.length;o++)null!=disksOnTowers[2][o]&&t++;return t==parseInt(document.hanoi.diskno.options[document.hanoi.diskno.options.selectedIndex].text)&&(e=!0),e}function pushDisk(e,t){var o=parseInt(e.style.width),n=parseInt(document.getElementById("tower"+t).style.left),s=disksOnTowers[t-1][0];null!=s?(topDiskWidth=parseInt(s.style.width),topDiskTop=parseInt(s.style.top),e.style.left=n+midhoriztower-o/2+"px",e.style.top=topDiskTop-diskheight-1+"px"):(e.style.left=n+midhoriztower-o/2+"px",e.style.top=basetop-diskheight-1+"px")}function getNewTop(e,t){if(null==t){for(var o=0;o<disksOnTower1.length-1;o++)disksOnTowers[e-1][o]=disksOnTowers[e-1][o+1];disksOnTowers[e-1][disksOnTower1.length-1]=null}else{for(o=disksOnTower1.length-1;o>=1;o--)disksOnTowers[e-1][o]=disksOnTowers[e-1][o-1];disksOnTowers[e-1][0]=t}}function solve(e){if("Solve"==e.value){if(movectr>0&&!gameOver&&!stop&&!confirm("当前的游戏将被中止，你想继续吗?"))return;e.value="Stop",initVars(),stop=!1,demo=!0;var o=document.hanoi;o.btnRes.disabled=!0,o.btnUndo.disabled=!0,disknum=parseInt(o.diskno.options[o.diskno.options.selectedIndex].text),drawDisks(disknum),getMoves(0,2,1,disknum),t=window.setTimeout("moveDisk()",delay)}else t&&(window.clearTimeout(t),e.value="Solve",frm.btnRes.disabled=!1,t=null,stop=!0,demo=!1)}function moveDisk(){frm=document.hanoi,disk=disksOnTowers[arrFr[pos]][0],pushDisk(disk,arrTo[pos]+1),getNewTop(arrFr[pos]+1,null),getNewTop(arrTo[pos]+1,disk),movectr++,frm.yourmove.value=movectr,pos++,movectr<parseInt(frm.minmove.value)?t=window.setTimeout("moveDisk()",delay):(setTimeout(function(){alert(movectr+" 步！你还能够更快完成它吗？")},500),gameOver=!0,stop=!1,frm.btnSolve.value="Solve",frm.btnRes.disabled=!1)}function getMoves(e,t,o,n){n>1?(getMoves(e,o,t,n-1),arrFr[idx]=e,arrTo[idx++]=t,getMoves(o,t,e,n-1)):(arrFr[idx]=e,arrTo[idx++]=t)}function unDo(e){disk=disksOnTowers[currTower-1][0],pushDisk(disk,prevTower),getNewTop(currTower,null),getNewTop(prevTower,disk),movectr--,document.hanoi.yourmove.value=movectr,e.disabled=!0}var delay=200,drag=!1,objDisk=null,x=0,y=0,disksOnTower1=new Array(null,null,null,null,null,null,null,null),disksOnTower2=new Array(null,null,null,null,null,null,null,null),disksOnTower3=new Array(null,null,null,null,null,null,null,null),disksOnTowers=new Array(disksOnTower1,disksOnTower2,disksOnTower3),offsetleft=30,offsettop=30,offsettower=20,offsethoriz=30,basetop=0,diskheight=0,midhoriztower=0,indexTo=1,indexFr=1,movectr=0,gameOver=!1,prevIndex=0,zindex=0,currTower=1,prevTower=1,demo=!1,arrFr=new Array(255),arrTo=new Array(255),idx=0,pos=0,t=null,stop=!1;