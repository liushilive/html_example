(function(t){"use strict";var e="ontouchstart"in window||navigator.msMaxTouchPoints;t.fn.dad=function(a){var o=this,s={target:">div",draggable:!1,placeholder:"",callback:!1,containerClass:"dad-container",childrenClass:"dads-children",cloneClass:"dads-children-clone",active:!0},n=t.extend({},s,a);return t(this).each(function(){function a(e){var a=1;e.find(f).each(function(){t(this).attr("data-dad-position",a),a++})}function s(){if(0!=m.target&&0!=m.clone){0!=p&&p(m.target);var e=m.target,o=m.clone,s=m.placeholder,n=0,i=0;t.contains(r[0],m.target[0])?m.clone.animate({top:m.target.offset().top-r.offset().top-i,left:m.target.offset().left-r.offset().left-n},300,function(){e.css({visibility:"visible"}).removeClass("active"),o.remove()}):m.clone.fadeOut(300,function(){o.remove()}),s.remove(),m.clone=!1,m.placeholder=!1,m.target=!1,a(r)}t("html, body").removeClass("dad-noSelect")}function i(e){if(!1!==m.target&&!1!==m.clone){var a=t('<span style="display:none"></span>'),o=t('<span style="display:none"></span>');e.prevAll().hasClass("active")?e.after(o):e.before(o),m.target.before(a),o.before(m.target),m.placeholder.css({top:m.target.offset().top-r.offset().top,left:m.target.offset().left-r.offset().left,width:m.target.outerWidth()-10,height:m.target.outerHeight()-10}),a.remove(),o.remove()}}var l=n.active,r=t(this),d=n.childrenClass,c=n.cloneClass,f="."+d,h=r.find(n.target),u=n.placeholder,p=n.callback,g="dad-draggable-area",v="dads-children-placeholder",m={x:0,y:0,target:!1,clone:!1,placeholder:!1,cloneoffset:{x:0,y:0},updatePosition:function(t){this.x=t.pageX,this.y=t.pageY},move:function(t){this.updatePosition(t),!1!==this.clone&&!1!==o.target&&this.clone.css({left:this.x-this.cloneoffset.x,top:this.y-this.cloneoffset.y})}};t(window).on("mousemove touchmove",function(a){var o=a;if(!1!==m.clone&&!1!==m.target&&a.preventDefault(),e&&"touchmove"==a.type){o=a.originalEvent.touches[0];var s=document.elementFromPoint(o.clientX,o.clientY);t(s).trigger("touchenter")}m.move(o)}),r.addClass(n.containerClass),r.hasClass("dad-active")||!0!==l||r.addClass("dad-active"),o.addDropzone=function(e,a){t(e).on("mouseenter touchenter",function(){!1!==m.target&&(m.placeholder.css({display:"none"}),m.target.css({display:"none"}),t(this).addClass("active"))}).on("mouseup touchend",function(){0!=m.target&&(m.placeholder.css({display:"block"}),m.target.css({display:"block"}),a(m.target),s()),t(this).removeClass("active")}).on("mouseleave touchleave",function(){!1!==m.target&&(m.placeholder.css({display:"block"}),m.target.css({display:"block"})),t(this).removeClass("active")})},o.getPosition=function(){var e=[];return t(this).find(f).each(function(){e[t(this).attr("data-dad-id")]=parseInt(t(this).attr("data-dad-position"))}),e},o.activate=function(){return l=!0,r.hasClass("dad-active")||r.addClass("dad-active"),o},o.deactivate=function(){return l=!1,r.removeClass("dad-active"),o},r.on("DOMNodeInserted",function(e){var a=t(e.target);a.hasClass(d)||a.hasClass(v)||a.addClass(d)}),t(document).on("mouseup touchend",function(){s()});var C=1;h.addClass(d).each(function(){null==t(this).data("dad-id")&&t(this).attr("data-dad-id",C),t(this).attr("data-dad-position",C),C++});var y=!1!==n.draggable?n.draggable:f;r.find(y).addClass(g),r.on("mousedown touchstart",y,function(e){if("touchstart"==e.type&&m.updatePosition(e.originalEvent.touches[0]),0==m.target&&1==l&&(1==e.which||"touchstart"==e.type)){var a=t(this);!1!==n.draggable?m.target=r.find(f).has(this):m.target=a,m.clone=m.target.clone(),m.target.css({visibility:"hidden"}).addClass("active"),m.clone.addClass(c),r.append(m.clone);var o=t("<div></div>");m.placeholder=o,m.placeholder.addClass(v),m.placeholder.css({top:m.target.offset().top-r.offset().top,left:m.target.offset().left-r.offset().left,width:m.target.outerWidth()-10,height:m.target.outerHeight()-10,lineHeight:m.target.height()-18+"px",textAlign:"center"}).text(u),r.append(m.placeholder);var s=Math.floor(parseFloat(r.css("border-left-width"))),i=Math.floor(parseFloat(r.css("border-top-width"))),h=m.x-m.target.offset().left+r.offset().left+s,p=m.y-m.target.offset().top+r.offset().top+i;m.cloneoffset.x=h,m.cloneoffset.y=p,m.clone.removeClass(d).css({position:"absolute",top:m.y-m.cloneoffset.y,left:m.x-m.cloneoffset.x}),t("html,body").addClass("dad-noSelect")}}),r.on("mouseenter touchenter",f,function(){i(t(this))})}),this}})(jQuery);